var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r},GameGiveUpView=function(t){function e(){return t.call(this,GameGiveUp)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.btn_sure.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQuit,this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this)},e.prototype.show=function(){t.prototype.show.call(this),this.GiveUpGroup.scaleX=this.GiveUpGroup.scaleY=.3,egret.Tween.get(this.GiveUpGroup).to({scaleX:1,scaleY:1},360,egret.Ease.bounceOut)},e.prototype.addMesssgaeListener=function(){var e=this;t.prototype.addMesssgaeListener.call(this),App.MessageCenter.addListener(EventMessage.gameCloseGiveUp,function(){e.close()},this)},e.prototype.dispose=function(){t.prototype.dispose.call(this)},e.prototype.onCancel=function(){this.close()},e.prototype.onQuit=function(t){this.close(),App.MessageCenter.dispatch(EventMessage.GameGiveUp)},e}(StateEui);__reflect(GameGiveUpView.prototype,"GameGiveUpView");var Common=function(){function t(){}return t.showErrorMsg_Game=function(e){e=e+"("+t.ServerIndex+")",GamePopView.Popup(Game.getInstance().stateManager.curState,e,function(){Platform.curPlatform.gameOver(1)})},t.createChatId=function(t){var e=t[0],r=t[1];return r>e?e+"_"+r:r+"_"+e},t.ServerIndex=-1,t}();__reflect(Common.prototype,"Common");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),egret.lifecycle.onPause=function(){App.SoundManager.setBgOn(!1),App.SoundManager.setEffectOn(!1)},egret.lifecycle.onResume=function(){App.SoundManager.setBgOn(!0),App.SoundManager.setEffectOn(!0)},e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.ImageLoader.crossOrigin="anonymous",egret.registerImplementation("eui.IAssetAdapter",new AssetAdapter),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.setMaxLoadingThread(8),App.DebugUtils.isOpen(!0),App.StageUtils.setFrameRate(60),Proto.init(),this.initPlatform();var e="resource/";App.Language==LanguageType.En&&(e="resource_En/");var r=new eui.Theme(e+"default.thm.json",this.stage);r.once(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},e.prototype.onThemeLoadComplete=function(){this.initMain()},e.prototype.initPlatform=function(){var t=Platform.G360;Platform.initPlatform(t)},e.prototype.initMain=function(){var t;t=new GameMain,this.stage.addChild(t),this.stage.removeChild(this)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var md5=function(){function t(){this.hexcase=0,this.b64pad=""}return t.prototype.hex_md5=function(t){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(t)))},t.prototype.b64_md5=function(t){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(t)))},t.prototype.any_md5=function(t,e){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(t)),e)},t.prototype.hex_hmac_md5=function(t,e){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.prototype.b64_hmac_md5=function(t,e){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.prototype.any_hmac_md5=function(t,e,r){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)),r)},t.prototype.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},t.prototype.rstr_md5=function(t){return this.binl2rstr(this.binl_md5(this.rstr2binl(t),8*t.length))},t.prototype.rstr_hmac_md5=function(t,e){var r=this.rstr2binl(t);r.length>16&&(r=this.binl_md5(r,8*t.length));for(var i=Array(16),a=Array(16),s=0;16>s;s++)i[s]=909522486^r[s],a[s]=1549556828^r[s];var n=this.binl_md5(i.concat(this.rstr2binl(e)),512+8*e.length);return this.binl2rstr(this.binl_md5(a.concat(n),640))},t.prototype.rstr2hex=function(t){try{this.hexcase}catch(e){this.hexcase=0}for(var r,i=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",a="",s=0;s<t.length;s++)r=t.charCodeAt(s),a+=i.charAt(r>>>4&15)+i.charAt(15&r);return a},t.prototype.rstr2b64=function(t){try{this.b64pad}catch(e){this.b64pad=""}for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="",a=t.length,s=0;a>s;s+=3)for(var n=t.charCodeAt(s)<<16|(a>s+1?t.charCodeAt(s+1)<<8:0)|(a>s+2?t.charCodeAt(s+2):0),o=0;4>o;o++)i+=8*s+6*o>8*t.length?this.b64pad:r.charAt(n>>>6*(3-o)&63);return i},t.prototype.rstr2any=function(t,e){var r,i,a,s,n,o=e.length,h=Array(Math.ceil(t.length/2));for(r=0;r<h.length;r++)h[r]=t.charCodeAt(2*r)<<8|t.charCodeAt(2*r+1);var p=Math.ceil(8*t.length/(Math.log(e.length)/Math.log(2))),d=Array(p);for(i=0;p>i;i++){for(n=Array(),s=0,r=0;r<h.length;r++)s=(s<<16)+h[r],a=Math.floor(s/o),s-=a*o,(n.length>0||a>0)&&(n[n.length]=a);d[i]=s,h=n}var l="";for(r=d.length-1;r>=0;r--)l+=e.charAt(d[r]);return l},t.prototype.str2rstr_utf8=function(t){for(var e,r,i="",a=-1;++a<t.length;)e=t.charCodeAt(a),r=a+1<t.length?t.charCodeAt(a+1):0,e>=55296&&56319>=e&&r>=56320&&57343>=r&&(e=65536+((1023&e)<<10)+(1023&r),a++),127>=e?i+=String.fromCharCode(e):2047>=e?i+=String.fromCharCode(192|e>>>6&31,128|63&e):65535>=e?i+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):2097151>=e&&(i+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return i},t.prototype.str2rstr_utf16le=function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(255&t.charCodeAt(r),t.charCodeAt(r)>>>8&255);return e},t.prototype.str2rstr_utf16be=function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t.charCodeAt(r)>>>8&255,255&t.charCodeAt(r));return e},t.prototype.rstr2binl=function(t){for(var e=Array(t.length>>2),r=0;r<e.length;r++)e[r]=0;for(var r=0;r<8*t.length;r+=8)e[r>>5]|=(255&t.charCodeAt(r/8))<<r%32;return e},t.prototype.binl2rstr=function(t){for(var e="",r=0;r<32*t.length;r+=8)e+=String.fromCharCode(t[r>>5]>>>r%32&255);return e},t.prototype.binl_md5=function(t,e){t[e>>5]|=128<<e%32,t[(e+64>>>9<<4)+14]=e;for(var r=1732584193,i=-271733879,a=-1732584194,s=271733878,n=0;n<t.length;n+=16){var o=r,h=i,p=a,d=s;r=this.md5_ff(r,i,a,s,t[n+0],7,-680876936),s=this.md5_ff(s,r,i,a,t[n+1],12,-389564586),a=this.md5_ff(a,s,r,i,t[n+2],17,606105819),i=this.md5_ff(i,a,s,r,t[n+3],22,-1044525330),r=this.md5_ff(r,i,a,s,t[n+4],7,-176418897),s=this.md5_ff(s,r,i,a,t[n+5],12,1200080426),a=this.md5_ff(a,s,r,i,t[n+6],17,-1473231341),i=this.md5_ff(i,a,s,r,t[n+7],22,-45705983),r=this.md5_ff(r,i,a,s,t[n+8],7,1770035416),s=this.md5_ff(s,r,i,a,t[n+9],12,-1958414417),a=this.md5_ff(a,s,r,i,t[n+10],17,-42063),i=this.md5_ff(i,a,s,r,t[n+11],22,-1990404162),r=this.md5_ff(r,i,a,s,t[n+12],7,1804603682),s=this.md5_ff(s,r,i,a,t[n+13],12,-40341101),a=this.md5_ff(a,s,r,i,t[n+14],17,-1502002290),i=this.md5_ff(i,a,s,r,t[n+15],22,1236535329),r=this.md5_gg(r,i,a,s,t[n+1],5,-165796510),s=this.md5_gg(s,r,i,a,t[n+6],9,-1069501632),a=this.md5_gg(a,s,r,i,t[n+11],14,643717713),i=this.md5_gg(i,a,s,r,t[n+0],20,-373897302),r=this.md5_gg(r,i,a,s,t[n+5],5,-701558691),s=this.md5_gg(s,r,i,a,t[n+10],9,38016083),a=this.md5_gg(a,s,r,i,t[n+15],14,-660478335),i=this.md5_gg(i,a,s,r,t[n+4],20,-405537848),r=this.md5_gg(r,i,a,s,t[n+9],5,568446438),s=this.md5_gg(s,r,i,a,t[n+14],9,-1019803690),a=this.md5_gg(a,s,r,i,t[n+3],14,-187363961),i=this.md5_gg(i,a,s,r,t[n+8],20,1163531501),r=this.md5_gg(r,i,a,s,t[n+13],5,-1444681467),s=this.md5_gg(s,r,i,a,t[n+2],9,-51403784),a=this.md5_gg(a,s,r,i,t[n+7],14,1735328473),i=this.md5_gg(i,a,s,r,t[n+12],20,-1926607734),r=this.md5_hh(r,i,a,s,t[n+5],4,-378558),s=this.md5_hh(s,r,i,a,t[n+8],11,-2022574463),a=this.md5_hh(a,s,r,i,t[n+11],16,1839030562),i=this.md5_hh(i,a,s,r,t[n+14],23,-35309556),r=this.md5_hh(r,i,a,s,t[n+1],4,-1530992060),s=this.md5_hh(s,r,i,a,t[n+4],11,1272893353),a=this.md5_hh(a,s,r,i,t[n+7],16,-155497632),i=this.md5_hh(i,a,s,r,t[n+10],23,-1094730640),r=this.md5_hh(r,i,a,s,t[n+13],4,681279174),s=this.md5_hh(s,r,i,a,t[n+0],11,-358537222),a=this.md5_hh(a,s,r,i,t[n+3],16,-722521979),i=this.md5_hh(i,a,s,r,t[n+6],23,76029189),r=this.md5_hh(r,i,a,s,t[n+9],4,-640364487),s=this.md5_hh(s,r,i,a,t[n+12],11,-421815835),a=this.md5_hh(a,s,r,i,t[n+15],16,530742520),i=this.md5_hh(i,a,s,r,t[n+2],23,-995338651),r=this.md5_ii(r,i,a,s,t[n+0],6,-198630844),s=this.md5_ii(s,r,i,a,t[n+7],10,1126891415),a=this.md5_ii(a,s,r,i,t[n+14],15,-1416354905),i=this.md5_ii(i,a,s,r,t[n+5],21,-57434055),r=this.md5_ii(r,i,a,s,t[n+12],6,1700485571),s=this.md5_ii(s,r,i,a,t[n+3],10,-1894986606),a=this.md5_ii(a,s,r,i,t[n+10],15,-1051523),i=this.md5_ii(i,a,s,r,t[n+1],21,-2054922799),r=this.md5_ii(r,i,a,s,t[n+8],6,1873313359),s=this.md5_ii(s,r,i,a,t[n+15],10,-30611744),a=this.md5_ii(a,s,r,i,t[n+6],15,-1560198380),i=this.md5_ii(i,a,s,r,t[n+13],21,1309151649),r=this.md5_ii(r,i,a,s,t[n+4],6,-145523070),s=this.md5_ii(s,r,i,a,t[n+11],10,-1120210379),a=this.md5_ii(a,s,r,i,t[n+2],15,718787259),i=this.md5_ii(i,a,s,r,t[n+9],21,-343485551),r=this.safe_add(r,o),i=this.safe_add(i,h),a=this.safe_add(a,p),s=this.safe_add(s,d)}return[r,i,a,s]},t.prototype.md5_cmn=function(t,e,r,i,a,s){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(e,t),this.safe_add(i,s)),a),r)},t.prototype.md5_ff=function(t,e,r,i,a,s,n){return this.md5_cmn(e&r|~e&i,t,e,a,s,n)},t.prototype.md5_gg=function(t,e,r,i,a,s,n){return this.md5_cmn(e&i|r&~i,t,e,a,s,n)},t.prototype.md5_hh=function(t,e,r,i,a,s,n){return this.md5_cmn(e^r^i,t,e,a,s,n)},t.prototype.md5_ii=function(t,e,r,i,a,s,n){return this.md5_cmn(r^(e|~i),t,e,a,s,n)},t.prototype.safe_add=function(t,e){var r=(65535&t)+(65535&e),i=(t>>16)+(e>>16)+(r>>16);return i<<16|65535&r},t.prototype.bit_rol=function(t,e){return t<<e|t>>>32-e},t}();__reflect(md5.prototype,"md5");var RankList=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setData=function(t){var e=App.GameWidth,r=App.GameHeight,i=new egret.Shape;i.touchEnabled=!0,i.graphics.beginFill(0,.7),i.graphics.drawRect(0,0,e,r),i.graphics.endFill(),this.addChild(i),this.bg=new egret.Bitmap(RES.getRes("rankBg_png")),this.bg.x=e-this.bg.width>>1,this.bg.y=(r-this.bg.height>>1)-70,this.addChild(this.bg);for(var a=new egret.DisplayObjectContainer,s=t.length,n=0;s>n;++n){var o=t[n],h=new egret.Sprite;h.graphics.beginFill(16711680,0),h.graphics.drawRect(0,0,490,70),h.graphics.endFill(),h.y=85*n;var p=new egret.TextField;p.text=n+1+"",p.anchorOffsetX=.5*p.width,p.x=40,p.y=23,p.bold=!0,p.scaleX=.7,p.size=44,h.addChild(p),0==n?p.textColor=16759040:1==n?p.textColor=12646143:2==n?p.textColor=15365679:p.textColor=6710886;var d=new RoleHeadImage(o.head,"rankItemBG_s_png",64,64);d.x=100,d.y=10,h.addChild(d);var l=new egret.TextField;l.size=18,l.x=190,l.y=34,l.textColor=3355443,l.text=o.name,h.addChild(l),a.addChild(h);var c=new egret.TextField;if(c.text=o.des+"",c.anchorOffsetX=.5*c.width,c.x=320,c.y=30,c.textColor=3355443,c.bold=!0,h.addChild(c),a.addChild(h),n!=s-1){var u=new egret.Shape;u.graphics.lineStyle(2,16768101,1),u.graphics.moveTo(0,0),u.graphics.lineTo(357,0),u.x=30,u.y=84,h.addChild(u)}}var g=new egret.ScrollView;g.width=490,g.height=498,g.setContent(a),g.horizontalScrollPolicy="off",g.x=this.bg.x+20,g.y=this.bg.y+100,this.addChild(g);var m=new egret.Bitmap(RES.getRes("rankCloseBtn_png"));m.anchorOffsetX=m.width>>1,m.anchorOffsetY=m.height>>1,m.x=e>>1,m.y=this.bg.y+810,m.touchEnabled=!0,this.addChild(m),m.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){m.scaleX=m.scaleY=.9},this),m.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){m.scaleX=m.scaleY=1,this.parent.removeChild(this)},this),m.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){m.scaleX=m.scaleY=1},this)},e.prototype.setSelfData=function(t){var e=new egret.Sprite;e.graphics.beginFill(16711680,0),e.graphics.drawRect(0,0,490,70),e.graphics.endFill();var r=new egret.TextField;r.text=t.rank,r.anchorOffsetX=.5*r.width,r.x=40,r.y=23,r.bold=!0,r.scaleX=.7,r.size=44,e.addChild(r),r.textColor=6710886;var i=new RoleHeadImage(t.head,"rankItemBG_s_png",64,64);i.x=100,i.y=10,e.addChild(i);var a=new egret.TextField;a.text=t.name,a.size=18,a.x=190,a.y=34,a.textColor=3355443,e.addChild(a);var s=new egret.TextField;s.text=t.des,s.anchorOffsetX=.5*s.width,s.x=320,s.y=30,s.textColor=3355443,s.bold=!0,e.addChild(s),e.x=this.bg.x+20,e.y=this.bg.y+610,this.addChild(e)},e}(egret.DisplayObjectContainer);__reflect(RankList.prototype,"RankList");var RankListS=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setData=function(t){var e=new egret.Bitmap(RES.getRes("rankBg_s_png"));e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){var e=new RankList;e.setData(t);for(var r=1,i=!1,a=0,s=t;a<s.length;a++){var n=s[a];if(n.id==Platform.curPlatform.platformData.userId){var o={name:n.name,des:n.des,head:n.head,rank:r.toString()};e.setSelfData(o),i=!0}r++}if(!i){var h=Platform.curPlatform.platformData,o={name:h.userName,des:"XX",head:h.userPic,rank:"X"};e.setSelfData(o),i=!0}this.stage.addChild(e)},this),this.addChild(e);var r=new egret.DisplayObjectContainer;r.x=12,r.y=30,this.addChild(r);for(var i=t.length>4?4:t.length,a=0;i>a;++a){var s=t[a],n=new egret.DisplayObjectContainer;n.y=90*a,r.addChild(n);var o=new egret.Shape,h=void 0;h=0==a?16759040:1==a?12646143:2==a?15365679:16777215,o.graphics.beginFill(h),o.graphics.drawRoundRect(0,0,80,80,45),o.graphics.endFill(),n.addChild(o);var p=new RoleHeadImage(s.head,"rankItemBG_s_png",70,70);p.x=5,p.y=5,n.addChild(p);var d=new egret.TextField;d.size=60,d.x=8,d.y=22,d.scaleX=.7,d.text=a+1+"",n.addChild(d),0==a?(d.stroke=4,d.strokeColor=16759040):1==a?(d.stroke=4,d.strokeColor=12646143):2==a&&(d.stroke=4,d.strokeColor=15365679)}var l=new egret.Bitmap(RES.getRes("rankMore_png"));l.x=15,l.y=392,this.addChild(l)},e}(egret.DisplayObjectContainer);__reflect(RankListS.prototype,"RankListS");var Game=function(t){function e(){var e=t.call(this)||this;return e.sendResultStartTime=0,e.currGameId=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAdded,e),e}return __extends(e,t),e.getInstance=function(){var t=this;return null==t.instance&&(t.instance=new e),t.instance},e.prototype.onAdded=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this),this.initLayer(),this.init()},e.prototype.initLayer=function(){this.layer=new egret.DisplayObjectContainer,this.addChild(this.layer),this.euiLayer=new eui.UILayer,this.euiLayer.percentWidth=100,this.euiLayer.percentHeight=100,this.euiLayer.touchEnabled=!1,this.addChild(this.euiLayer),this.popupLayer=new eui.UILayer,this.popupLayer.percentWidth=100,this.popupLayer.percentHeight=100,this.popupLayer.touchEnabled=!1,this.addChild(this.popupLayer)},e.prototype.init=function(){this.initBgMusic(),this.initPlatform(),this.initView(),this.initMessage(),this.isInit=!0,new NetWorkDelayTest},e.prototype.initMessage=function(){App.MessageCenter.addListener(Proto.ID_error_notice_s2c,this.errorS2C,this),App.MessageCenter.addListener(EventMessage.SendGameResultC2S,this.onSendGameResultC2S,this),App.MessageCenter.addListener(EventMessage.SendGameEventC2S,this.onSendGameEventC2S,this),App.MessageCenter.addListener(Proto.ID_game_event_notice_s2c,this.onReceiveGameEventS2C,this),App.MessageCenter.addListener(Proto.ID_game_result_notice_s2c,this.onReceiveGameResultS2C,this),App.MessageCenter.addListener(EventMessage.AddErrQuestionC2S,this.onAddErrQuestionC2S,this),App.MessageCenter.addListener(EventMessage.GetQuestionsC2S,this.onGetQuestionsC2S,this),App.MessageCenter.addListener(EventMessage.GetDataC2S,this.onGetDataC2S,this)},e.prototype.initBgMusic=function(){App.SoundManager.setBgOn(!0),App.SoundManager.setEffectOn(!0),Platform.curPlatform.dealBgMusic()},e.prototype.initView=function(){this.stateManager.setCurStateName("index"),this.stateManager.startTick()},e.prototype.initPlatform=function(){this.stateManager=new StateManager(this.layer,this.euiLayer,this.popupLayer),this.stateManager.registerState("index",new Index),this.stateManager.registerState("gamePopup",new GamePopView),this.stateManager.registerState("GameSureLeave",new GameSureLeaveView),this.stateManager.registerState("GameGiveUp",new GameGiveUpView),this.stateManager.registerState("GameExpress",new GameExpressTip)},e.prototype.getGameClass=function(t){switch(t){case"gameLongJump":return GameLongJumpView}},e.prototype.joinGame=function(t){this.currGameId=t;var e=DataCenter.instance.getGameConfig(this.currGameId);if(!e)return void console.error("请先在gameConfig.json中进行配置");var r=e.stateName,i=this.getGameClass(r);return i?(this.stateManager.registerState(r,new i),void this.stateManager.curState.next(r)):void console.error("请先在gameClassList中进行配置")},e.prototype.leaveGame=function(t){if(void 0===t&&(t="gameChangeMatch"),!this.currGameId)return void this.stateManager.curState.next(t);var e=DataCenter.instance.getGameConfig(this.currGameId),r=e.stateName;this.stateManager.unregisterState(r),this.stateManager.curState.next(t),this.destoryGameRes(this.currGameId),this.currGameId=0,ProxySocket.stop(),App.SoundManager.stopBg()},e.prototype.destoryGameRes=function(t){var e=DataCenter.instance.getGameConfig(t);if(e){var r=RES.getRes("dbAssetConfig_json");AssetManager.removeDBAnimation(r.db[t.toString()]),RES.destroyRes(e.res)}},e.prototype.isGameing=function(){return this.currGameId>0},e.prototype.errorS2C=function(t){},e.prototype.onSendGameResultC2S=function(t){this.sendResultStartTime=egret.getTimer(),ProxySocket.sendGameResult(App.CurrRoomId,t)},e.prototype.onSendGameEventC2S=function(t,e){ProxySocket.sendGameEvent(App.CurrRoomId,t,e)},e.prototype.onReceiveGameEventS2C=function(t){t.userId=t.userId.toString(),App.MessageCenter.dispatch(EventMessage.ReceiveGameEventS2C,t)},e.prototype.onReceiveGameResultS2C=function(t){egret.getTimer()-this.sendResultStartTime;App.MessageCenter.dispatch(EventMessage.ReceiveGameResultS2C,t)},e.prototype.onGetQuestionsC2S=function(t){ProxyHttp.getQuestions(App.CurrRoomId,function(e){t(e.data)})},e.prototype.onGetDataC2S=function(t){ProxyHttp.getData(window.egretGid,function(e){t(e.data)})},e.prototype.onAddErrQuestionC2S=function(t,e){},e}(egret.DisplayObjectContainer);__reflect(Game.prototype,"Game");var NetWorkDelayTest=function(){function t(){this.clickNum=0,this.init()}return t.prototype.init=function(){this.netWorktext=new egret.TextField,this.netWorktext.borderColor=16711680,this.netWorktext.border=!0,this.netWorktext.width=400,this.netWorktext.height=34,this.netWorktext.x=(App.GameWidth-this.netWorktext.width)/2,this.netWorktext.y=10,this.netWorktext.textColor=0,this.netWorktext.strokeColor=16711680,this.netWorktext.stroke=2,this.netWorktext.size=30,this.netWorktext.textAlign="center",this.initMessage(),App.StageUtils.getStage().addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},t.prototype.onClick=function(t){var e=this;t.$stageY>50||(0==this.clickNum&&egret.setTimeout(function(){e.clickNum>=5?e.onStartSendNetWork():e.clickNum=0},this,1e3),this.clickNum++)},t.prototype.initMessage=function(){App.MessageCenter.addListener(Proto.ID_client_network_s2c,this.onGetNetWorkS2C,this)},t.prototype.onGetNetWorkS2C=function(t){var e=egret.getTimer()-parseInt(t.time.toString());this.netWorktext.text="Server："+Common.ServerIndex+" 延迟: "+e+" 毫秒"},t.prototype.onStartSendNetWork=function(){this.ontimerUpdate(),App.StageUtils.getStage().addChild(this.netWorktext),App.TimerManager.doTimer(2e3,0,this.ontimerUpdate,this)},t.prototype.onStopSendNetWork=function(){App.TimerManager.remove(this.ontimerUpdate,this)},t.prototype.ontimerUpdate=function(){var t=egret.getTimer(),e=new client_network_c2s;e.time=t,App.Socket.send(e)},t}();__reflect(NetWorkDelayTest.prototype,"NetWorkDelayTest");var GameChangeMatchView=function(t){function e(){return t.call(this,GameChangeMatchSkin)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.startMatchBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startMatchBtnHandler,this),this.inviteFriendBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.inviteFriendBtnHandler,this),this.goBackBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this),this.img_help.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHelp,this)},e.prototype.showRank=function(t){},e.prototype.show=function(){t.prototype.show.call(this);var e=DataCenter.instance.getGameConfig(App.CurrGameId);this.img_icon.source=e.icon},e.prototype.tick=function(e){t.prototype.tick.call(this,e)},e.prototype.dispose=function(){t.prototype.dispose.call(this)},e.prototype.onBack=function(){App.SoundManager.playEffect("mouseClickSound_mp3"),this.next("gameIndex")},e.prototype.onHelp=function(){},e.prototype.addMesssgaeListener=function(){t.prototype.addMesssgaeListener.call(this),App.MessageCenter.addListener(Proto.ID_game_matching_s2c,this.successMatchingS2C,this),App.MessageCenter.addListener(SocketConst.SOCKET_CONNECT,this.connectSocketSuccess,this),App.MessageCenter.addListener(SocketConst.SOCKET_CLOSE,this.connectSocketClose,this),App.MessageCenter.addListener(SocketConst.SOCKET_NOCONNECT,this.connectSocketError,this)},e.prototype.startConnectMatchingServer=function(){var t=Platform.curPlatform.platformData.userId;ProxyHttp.getGameServer(t,function(t){var e=t.data;e.hasOwnProperty("useSSL")||(e.useSSL=!0),ProxySocket.init(e.host,e.port,e.useSSL),Common.ServerIndex=e.sindex})},e.prototype.connectSocketClose=function(){var t=RES.getRes("errorCode_json")[6001];Common.showErrorMsg_Game(t)},e.prototype.connectSocketError=function(){var t=RES.getRes("errorCode_json")[6002];Common.showErrorMsg_Game(t)},e.prototype.connectSocketSuccess=function(){ProxySocket.startPing();var t=Platform.curPlatform.platformData,e=t.userId,r=t.userName,i=t.userPic,a=t.userSex;ProxySocket.startMatching(App.CurrGameId,e,r,i,a)},e.prototype.successMatchingS2C=function(t){this.next("gameSeach")},e.prototype.startMatchBtnHandler=function(t){App.SoundManager.playEffect("mouseClickSound_mp3"),this.startConnectMatchingServer()},e.prototype.inviteFriendBtnHandler=function(t){App.SoundManager.playEffect("mouseClickSound_mp3"),Platform.curPlatform.invite(function(){Game.getInstance().stateManager.curState.next("gameSeach"),Game.getInstance().stateManager.curState.playWaitDB(),Game.getInstance().stateManager.curState.startConnectGameServer(App.CurrRoomId)})},e}(StateEui);__reflect(GameChangeMatchView.prototype,"GameChangeMatchView");var GameMain=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.euiLayer=new eui.UILayer,this.euiLayer.percentWidth=100,this.euiLayer.percentHeight=100,this.stage.addChild(this.euiLayer),this.loadingView=new LoadingUI_GameSLL,this.loadingView.bottom=0,this.euiLayer.addChild(this.loadingView);var e="resource/";App.ResourceUtils.addConfig(e+"default_wanba.res.json",e),App.ResourceUtils.addConfig(e+"gameLongJump.res.json",e),App.ResourceUtils.loadConfig(this.onConfigComplete,this)},e.prototype.onConfigComplete=function(t){App.ResourceUtils.loadGroup("preload",this.onResourceLoadComplete,this.onResourceProgress,this,this.onResourceError)},e.prototype.onResourceLoadComplete=function(t){if("preload"==t){var e=RES.getRes("dbAssetConfig_json");AssetManager.loadDBAnimation(e.db[0]),DataCenter.instance.initConfig(RES.getRes("gameConfig_json")),this.startPlatformLogin()}},e.prototype.onResourceProgress=function(t,e){this.loadingView.setBaseProgress(t,e)},e.prototype.onResourceError=function(){this.showErrorMsg_Loading("基础资源加载失败")},e.prototype.startPlatformLogin=function(){this.platformLogin()},e.prototype.platformLogin=function(){var t=this;this.loadingView.setProgressText("获取平台用户数据..."),Platform.curPlatform.login(function(e){if(!e)return void t.loadingView.setProgressText("获取平台用户数据失败...");t.loadingView.setProgressText("获取服务器地址...");Platform.curPlatform.platformData.roomId});var e={roomId:"1234",players:[{userId:"12",nickname:"11",headIconUrl:"",sex:"M",aiRank:1,type:0},{userId:"121",nickname:"1111",headIconUrl:"",sex:"M",aiRank:3,type:1}]};Platform.curPlatform.platformData.userId="12",this.loadingView.setProgressText("获取服务器地址...");var r,i;Platform.curPlatform.platformData.roomId;App.CurrRoomId=e.roomId;var a=e.players;App.CurrGameIsAi=!1;for(var s=0;s<a.length;s++){var n=a[s],o=new User(n.userId);o.name=n.nickname,o.imgUrl=n.headIconUrl,o.sex="M"==n.sex?1:2,o.uuid=n.userId,n.userId==Platform.curPlatform.platformData.userId?r=o:i=o,1==n.type&&(App.CurrGameIsAi=!0,App.CurrGameAiLevel=n.aiRank>5?5:n.aiRank)}r.curAvatarType=1,i.curAvatarType=2,DataCenter.instance.user=r,DataCenter.instance.room=new RoomVO(App.CurrRoomId,App.CurrGameId,i,App.CurrGameIsAi),App.CurrChatId=Common.createChatId([r.id,i.id]),this.loadingView.startGameLoad()},e.prototype.showErrorMsg_Loading=function(t){t=t+"("+Common.ServerIndex+")",this.loadingView.setProgressText(t),App.TimerManager.doTimer(2e3,1,function(){Platform.curPlatform.gameOver(1)},this)},e}(egret.DisplayObjectContainer);__reflect(GameMain.prototype,"GameMain");var GamePopView=function(t){function e(){return t.call(this,GamePopSkin)||this}return __extends(e,t),e.Popup=function(t,e,r){void 0===r&&(r=null),t.popup("gamePopup",{msg:e,callBack:r})},e.prototype.init=function(){t.prototype.init.call(this),this.btn_sure.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.show=function(e){t.prototype.show.call(this),this.lbl_msg.text=e.msg,this.callBack=e.callBack},e.prototype.addMesssgaeListener=function(){t.prototype.addMesssgaeListener.call(this)},e.prototype.dispose=function(){t.prototype.dispose.call(this)},e.prototype.onClick=function(){this.close(),this.callBack&&(this.callBack(),this.callBack=null)},e}(StateEui);__reflect(GamePopView.prototype,"GamePopView");var GameResultView=function(t){function e(){var e=t.call(this,GameResultViewSkin)||this;return e.num_time=5,e.particlesArr=[],e.gameCallBackFun=null,e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.btn_otherGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOtherGame,this),this.mask_1=new egret.Rectangle(0,0,57,18),this.mask_2=new egret.Rectangle(0,0,640,650),this.addAllDb()},e.prototype.show=function(r){void 0===r&&(r=null),t.prototype.show.call(this),this.gameCallBackFun=r||null,this.gameOverResultData=DataCenter.instance.room.gameResult,this.gameOverResultData.dayGetMoney=100,this.gameOverResultData.addMoney=100,1==this.gameOverResultData.userExitFlag&&this.gameOverResultData.winUserId==DataCenter.instance.user.id?(e.playerExitGameId=DataCenter.instance.room.player.id,this.gameResultStateImgFun(1)):1==this.gameOverResultData.userExitFlag&&this.gameOverResultData.winUserId==DataCenter.instance.room.player.id?(Game.getInstance().leaveGame(),this.close()):this.gameCallBackFun?(this.gameCallBackFun(),this.close()):(App.googleAd&&App.googleAd.show(),this.resultInfoFun())},e.prototype.gameResultStateImgFun=function(t){var r=this;if(e.gameInnerResult)e.gameInnerResult=!1,this.playerLeaveView.visible=!1,this.resultInfoFun();else{switch(t){case 1:this.gameResultStateImg.source="bg_result_playerLeave_png";break;case 2:this.gameResultStateImg.source="bg_result_You_Giveup_png";break;case 3:this.gameResultStateImg.source="bg_result_Other_Giveup_png"}var i=this;i.playerLeaveView.visible=!0,i.playerLeaveView.scaleX=i.playerLeaveView.scaleY=.3,egret.Tween.get(i.playerLeaveView).to({scaleX:1,scaleY:1},200,egret.Ease.bounceOut).wait(1600).to({scaleX:0,scaleY:0,visible:!1},200,egret.Ease.bounceOut).call(function(){i.gameCallBackFun?(r.gameCallBackFun(),e.gameInnerResult=!0,i.close()):(i.playerLeaveView.visible=!1,i.resultInfoFun())})}},e.prototype.resultInfoFun=function(){this.resultInfoView.visible=!0;var t=DataCenter.instance.user,r=DataCenter.instance.room.player,i=RES.getRes("system_json");this.lb_player_1.text=t.name,this.lb_player_2.text=r.name,this.img_sex1.source=GameCenterGetSexIcon.getSexIconSource(t.sex),this.img_sex2.source=GameCenterGetSexIcon.getSexIconSource(r.sex),this.gameOverResultData.winUserId==t.id?(this.bg_result1.source="bg_result_win_png",this.bg_result2.source="bg_result_Lose_png",this.onParticleEffect(this.gp_particle.width/2,398,"hua"),this.onParticleEffect(this.gp_particle.width/2,48,"falisnow")):(this.bg_result1.source="bg_result_Lose_png",this.bg_result2.source="bg_result_win_png",this.onParticleEffect(this.gp_particle.width/2,48,"hua"),this.onParticleEffect(this.gp_particle.width/2,398,"falisnow")),this.gameOverResultData.dayGetMoney<i.dayMaxMoney?(this.mask_1.width=116*Math.min(1,this.gameOverResultData.dayGetMoney/i.dayMaxMoney),this.img_coin.source="bg_result_TodayGetGold_png"):(this.mask_1.width=116,this.img_coin.source="img_max_coin_png"),this.lb_persentage.text=""+this.gameOverResultData.dayGetMoney+"/"+i.dayMaxMoney,this.mask_1.x=0,this.mask_1.y=-2,this.img_persentage.mask=this.mask_1,this.gp_particle.mask=this.mask_2,this.gameOverResultData.addMoney>0?this.lb_coin.text="+"+this.gameOverResultData.addMoney.toString():0==this.gameOverResultData.addMoney?this.lb_coin.text="":this.lb_coin.text=this.gameOverResultData.addMoney.toString(),null!=e.playerExitGameId&&e.playerExitGameId==r.id&&(e.playerExitGameId=null),this.addPerson()},e.prototype.addMesssgaeListener=function(){t.prototype.addMesssgaeListener.call(this),App.MessageCenter.addListener(EventMessage.gameResultLeave,this.onGameResultLeave,this),App.MessageCenter.addListener(EventMessage.ChangeAvatar,this.onChangeAvatarFun,this)},e.prototype.onChangeAvatarFun=function(){this.roleAvatar1=this.createAvatar(this.gp_people1,!0);var t=DataCenter.instance.user;this.gameOverResultData.winUserId==t.id?this.roleAvatar1.armature.play("win"):this.roleAvatar1.armature.play("Loser2")},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.particlesArr.splice(0),this.onClear(),this.gp_particle.removeChildren(),App.SoundManager.stopEffect("win_mp3"),App.SoundManager.stopEffect("lose_mp3"),App.SoundManager.restoreVolumeBg()},e.prototype.timer=function(){return this.num_time--,0==this.num_time?(App.TimerManager.remove(this.timer,this),void this.onOtherGame()):void 0},e.prototype.onGameResultLeave=function(){this.onOtherGame()},e.prototype.addAllDb=function(){this.dbresult1=AssetManager.getQuickDBArmature("winloser"),this.dbresult1.y=570,this.gp_1.addChild(this.dbresult1),this.dbresult1.addDisplayEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onPlayResultEnd,this),this.dbresult2=AssetManager.getQuickDBArmature("winloser"),this.dbresult2.y=230,this.gp_1.addChild(this.dbresult2),this.dbresult1.visible=!1,this.dbresult2.visible=!1},e.prototype.onPlayResultEnd=function(){var t=this;this.dbresult1.visible=!1,this.dbresult2.visible=!1;var e=DataCenter.instance.user;setTimeout(function(){for(var e=0;e<t.particlesArr.length;e++)t.particlesArr[e].stop()},5e3),this.gameOverResultData.winUserId==e.id},e.prototype.onClear=function(){e.playerExitGameId=null,this.resultInfoView.visible=!1,this.playerLeaveView.visible=!1,this.roleAvatar1&&(this.roleAvatar1.dispose(),this.roleAvatar1=null),this.roleAvatar2&&(this.roleAvatar2.dispose(),this.roleAvatar2=null)},e.prototype.onOtherGame=function(){this.close(),Game.getInstance().leaveGame()},e.prototype.addPerson=function(){this.roleAvatar1=this.createAvatar(this.gp_people1,!0),this.roleAvatar2=this.createAvatar(this.gp_people2,!1);var t=DataCenter.instance.user;this.dbresult1.visible=!0,this.dbresult2.visible=!0,this.gameOverResultData.winUserId==t.id?(this.dbresult2.play("loser",1),this.dbresult1.play("win",1),this.roleAvatar1.armature.play("win"),this.roleAvatar2.armature.play("Loser2"),App.SoundManager.playEffect("win_mp3")):(this.dbresult1.play("loser",1),this.dbresult2.play("win",1),this.roleAvatar1.armature.play("Loser2"),this.roleAvatar2.armature.play("win"),App.SoundManager.playEffect("lose_mp3")),this.dbresult1.x=this.gp_1.width/2,this.dbresult2.x=this.gp_1.width/2,App.SoundManager.muteBg()
},e.prototype.onParticleEffect=function(t,e,r,i,a){void 0===i&&(i=-1),void 0===a&&(a=1);var s=RES.getRes(r+"_png"),n=RES.getRes(r+"_json"),o=new particle.GravityParticleSystem(s,n);if(this.particlesArr.push(o),o.y=e,o.x=t,o.scaleX=a,"flowers"==r?this.gp_1.addChild(o):this.gp_particle.addChild(o),o.start(i),"hua"==r)for(var h=2;7>h;h++){r="hua"+h;var s=RES.getRes(r+"_png"),n=RES.getRes("hua_json"),o=new particle.GravityParticleSystem(s,n);this.particlesArr.push(o),o.y=e,o.x=t,o.scaleX=a,this.gp_particle.addChild(o),o.start(i)}},e.prototype.onLoseComplete=function(t){},e.prototype.createAvatar=function(t,e){t.removeChildren();var r;if(e){var i=DataCenter.instance.user;r=new RoleAvatar(i.curAvatarType,i.imgUrl)}else{var a=DataCenter.instance.room.player;r=new RoleAvatar(a.curAvatarType,a.imgUrl)}return r.armature.x=.5*t.width,r.armature.y=t.height,r.armature.scaleX=r.armature.scaleY=.8,t.addChild(r.armature),r},e.gameInnerResult=!1,e.gameOpenTimes=0,e.playerExitGameId=null,e}(StateEui);__reflect(GameResultView.prototype,"GameResultView");var GameSureLeaveView=function(t){function e(){return t.call(this,GameSureLeaveSkin)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.btn_sure.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQuit,this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this)},e.prototype.show=function(){t.prototype.show.call(this)},e.prototype.addMesssgaeListener=function(){t.prototype.addMesssgaeListener.call(this),App.MessageCenter.addListener(EventMessage.SendGameResultC2S,this.onCancel,this)},e.prototype.dispose=function(){t.prototype.dispose.call(this)},e.prototype.onCancel=function(){this.close()},e.prototype.onQuit=function(t){this.close(),App.SoundManager.stopBg(),App.MessageCenter.dispatch(EventMessage.GameLeave),App.Socket.isConnecting()?ProxySocket.exitGame(App.CurrRoomId):Game.getInstance().leaveGame()},e}(StateEui);__reflect(GameSureLeaveView.prototype,"GameSureLeaveView");var Index=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(State);__reflect(Index.prototype,"Index");var LoadingUI_GameSLL=function(t){function e(){var e=t.call(this,LoadingUISkin_Wanba)||this;return e.close=function(){App.MessageCenter.removeAll(e),e.parent.parent&&e.parent.parent.removeChild(e.parent)},e.percentHeight=100,e.percentWidth=100,e.setProgressText("加载基础资源..."),e}return __extends(e,t),e.prototype.setAssets=function(){var t=App.CurrGameId+"_jpg";this.logo.source=t,!this.loadProgressImgBg.source&&RES.getRes("LD_progressBG_png")&&(this.loadProgressImgBg.source="LD_progressBG_png"),!this.loadProgressImg.source&&RES.getRes("LD_progress_png")&&(this.loadProgressImg.source="LD_progress_png")},e.prototype.setBaseProgress=function(t,e){this.setAssets(),this.setProgress(Math.ceil(t/e*100))},e.prototype.setProgress=function(t){this.loadProgressImg.width=t/100*this.loadProgressImg.parent.width},e.prototype.setProgressText=function(t){this.loadProgressTxt&&(this.loadProgressTxt.text=t)},e.prototype.setErrorMsg=function(t){this.setProgressText(t),App.TimerManager.doTimer(2e3,1,function(){Platform.curPlatform.gameOver(1)},this)},e.prototype.addMesssgaeListener=function(){},e.prototype.startGameLoad=function(){this.addMesssgaeListener(),this.setProgressText("加载游戏资源..."),this.setProgress(0),this.loadGameSource()},e.prototype.loadGameSource=function(){var t=DataCenter.instance.getGameConfig(App.CurrGameId),e=t.res;App.ResourceUtils.loadGroup(e,this.onCompleteHandler,this.onProgressHandler,this,this.onErrorHandler)},e.prototype.onErrorHandler=function(){this.setErrorMsg("游戏资源加载失败")},e.prototype.onCompleteHandler=function(){var t=RES.getRes("dbAssetConfig_json");AssetManager.loadDBAnimation(t.db[App.CurrGameId.toString()]),ProxySocket.sendLoadProgress(App.CurrRoomId,100),this.runGame()},e.prototype.onProgressHandler=function(t,e){var r=Math.ceil(t/e*100);r=Math.min(r,99),ProxySocket.sendLoadProgress(App.CurrRoomId,r)},e.prototype.startGameS2C=function(t){this.runGame()},e.prototype.loadProgressS2C=function(t){t.userId.toString()==DataCenter.instance.user.id&&this.setProgress(t.progress)},e.prototype.initGame=function(){var t=Game.getInstance();this.stage.addChild(t),this.close()},e.prototype.runGame=function(){this.initGame(),Game.getInstance().joinGame(App.CurrGameId)},e.prototype.onGameResultS2C=function(t){DataCenter.instance.room?(this.initGame(),DataCenter.instance.room.gameResult=t,Game.getInstance().stateManager.curState.popup("GameResult")):this.setErrorMsg("对手已经离线，2秒后退出")},e}(EuiComponent);__reflect(LoadingUI_GameSLL.prototype,"LoadingUI_GameSLL");var Platform=function(){function t(){}return t.initPlatform=function(e){switch(t.curPlatformID=e,App.Language=LanguageType.Ch,t.curPlatformID){case t.G360:t.curPlatform=new PlatformJump}App.CurrPlatformUid=e.toString()},t.G360=16,t.curPlatformID=t.G360,t}();__reflect(Platform.prototype,"Platform");var PlatformJump=function(){function t(){this.init()}return t.prototype.init=function(){App.CurrGameId=11},t.prototype.login=function(t){var e=App.RandomUtils.limitInteger(1e4,2e4).toString();this.platformData={userId:e,userName:"PK"+e,userPic:"tou103_png",userSex:1,base64Avatar:"",otherUserId:null,otherUserName:null,otherUserPic:null,otherUserSex:null,roomId:e,isAi:null,aiLevel:null},App.CurrRoomId=this.platformData.roomId,App.CurrPlatformUid=this.platformData.roomId},t.prototype.onInit=function(t){},t.prototype.dealBgMusic=function(){},t.prototype.gameOver=function(t){var e=1;1==t?e=2:2==t?e=3:3==t&&(e=1)},t.prototype.invite=function(){},t.prototype.loaded=function(){},t}();__reflect(PlatformJump.prototype,"PlatformJump",["IPlatform"]);